<meta charset="UTF-8"/>
<div class="main-content container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="card card-border-color card-border-color-primary">
                <div class="card-header card-header-divider">供应商列表</span>
                </div>
                <div class="card-body">
                    <table id="table"></table>
                </div>
            </div>
        </div>
    </div>
</div>


<div id="toolbar">
    <button type="button" class="btn btn-space btn-success" onclick="loadPage('./html/supplier/supplier_add.html')">新增
    </button>
    <button type="button" class="btn btn-space btn-danger" onclick="delData()">删除
    </button>
</div>
<script>

    $(function () {
        $('#table').bootstrapTable({
            locale: 'zh-CN',
            url: './suppliers',
            method: 'get',                      //请求方式（*）
            pagination: true,  //是否分页
            dataType: "json",
            sidePagination: "server", //服务端处理分页
            silentSort: false,
            pageList: [10, 25, 50, 100],
            pageSize: 10,
            pageNumber: 1,
            detailView: false,
            /*   showColumns: true,                  //是否显示所有的列
               showRefresh: true,        */          //是否显示刷新按钮
            minimumCountColumns: 2,             //最少允许的列数
            toolbar: '#toolbar',
            clickToSelect: true,                //是否启用点击选中行
            queryParams: function (params) {
                var pageNo = 0;
                if (params.offset == 0) {
                    pageNo = 1;
                } else {
                    pageNo = params.offset / params.limit + 1;
                }

                var json = {
                    "pageSize": params.limit,
                    "pageNum": pageNo
                };
                return json;
            },
            columns: [{
                checkbox: true
            }, {
                field: 'name',
                title: '供应商名称'
            }, {
                field: 'typeName',
                title: '供应商类型'
            }, {
                field: 'address',
                title: '供应商地址'
            },{
                field: 'tel',
                title: '供应商联系电话'
            }, {
                field: 'id', title: "操作", formatter: function (value, row, index) {
                    var html = "<button type=\"button\" class=\"btn btn-space btn-primary\" onclick=\"editData('"+row.id+"')\">修改</button>";

                    return html;
                }
            }]
        });
    });


    function delData() {
        var data = $('#table').bootstrapTable('getSelections');
        var ids = "";
        $.each(data, function (index, value) {
            ids += value.id + ",";
        });
        console.log(ids);
        if (ids != null) {
            $.get("./suppliers/delete?id=" + ids, function (result) {
                if (result.code != 0) {
                    alert(result.msg);
                }
                $('#table').bootstrapTable('refresh');
            }, "json");
        }
    }

    function editData(id) {
        storage.setItem("id", id);
        loadPage("html/supplier/supplier_edit.html");
    }
</script>